
# Story 10.7: Navigate from HomeScreen Image to Detail View

**Status:** Draft

## Goal & Context

**User Story:** As a user, when I tap on an image in the `HomeScreen`'s trending photos grid, I want to be taken to the detailed view of that image.

**Context:** This story connects the `HomeScreen` (now displaying trending photos in a `LazyVerticalStaggeredGrid` as per Story 10.1) to the existing `ImageDetailScreen` (developed in Epic 4 and enhanced for zoom in Epic 6). It involves making the `ImageItem`s in the `HomeScreen`'s grid clickable and handling the navigation, with an attempt to include the shared element transition from Epic 9 for a richer UX. This implements PRD v1.2 [38], [183], [454].

## Detailed Requirements

* Make each `ImageItem` in the `LazyVerticalStaggeredGrid` on `HomeScreen` clickable. The existing `onItemClick: (Photo) -> Unit` lambda in `ImageItem` should be used.
* On tap of an `ImageItem` on `HomeScreen`, trigger navigation to the `ImageDetailScreen`.
* Pass the selected `Photo`'s ID (e.g., `photo.id`) to `ImageDetailScreen` via navigation arguments. This should be consistent with how search results navigate to the detail view (established in Story 4.1).
* **Shared Element Transition (from Story 9.1):** Attempt to apply the shared element transition for this navigation path.
    * This means the `AsyncImage` within the `ImageItem` on `HomeScreen` and the main `AsyncImage` in `ImageDetailScreen` need to be identified with a common, unique shared element tag (e.g., derived from `photo.id`).
    * The `LookaheadLayout` or the chosen shared element animation mechanism (from Epic 9) needs to be correctly set up or extended to work for this navigation path from `HomeScreen`. This might involve ensuring `LookaheadLayout` scopes correctly encompass both screens or that necessary animation parameters (like initial bounds, target bounds, shared keys) are communicated.

## Acceptance Criteria (ACs)

* AC1: Tapping an image in the `LazyVerticalStaggeredGrid` on `HomeScreen` successfully navigates the user to the `ImageDetailScreen`.
* AC2: The correct `Photo` data for the tapped image is passed to `ImageDetailScreen` (via `photoId` argument) and subsequently displayed (details handled by `ImageDetailScreen` and its ViewModel).
* AC3: Navigation is smooth.
* AC4: (If feasible and the shared element transition from Story 9.1 can be successfully adapted/applied here) A shared element transition animates the tapped image from its position in the `HomeScreen`'s staggered grid to its position in the `ImageDetailScreen`, and also animates back correctly when returning to `HomeScreen`.

## Technical Implementation Context

**Guidance:** Use the following details for implementation. `HomeScreen` (Story 10.1), `ImageDetailScreen` (Epic 4), and shared element transition concepts (Story 9.1) are relevant.

* **Relevant Files:**
    * Files to Modify:
        * `app/src/main/java/com/nguyenmoclam/pexelssample/ui/home/HomeScreen.kt` (to handle the click on `ImageItem` and initiate navigation).
        * `app/src/main/java/com/nguyenmoclam/pexelssample/ui/common/ImageItem.kt` (to ensure it correctly uses `onItemClick` and can accept any necessary modifiers for shared element transition, as potentially set up in Story 9.1).
        * `app/src/main/java/com/nguyenmoclam/pexelssample/core/navigation/AppNavigation.kt` (if shared element transitions need specific configurations at the `NavHost` or `composable` destination level for this path).
        * `app/src/main/java/com/nguyenmoclam/pexelssample/ui/detail/ImageDetailScreen.kt` (to ensure it can participate as the target of a shared element transition originating from `HomeScreen`).
    * _(Hint: `docs/coding-standards.md` for navigation and animations.)_

* **Key Technologies:**
    * Jetpack Navigation Compose (`navController.navigate(route)`).
    * `Modifier.clickable` (on `ImageItem`).
    * Shared Element Transition APIs from Jetpack Compose (e.g., `LookaheadLayout`, `Modifier.intermediateLayout`, `Modifier.layoutId` or similar for tagging, as explored in Story 9.1).
    * Stable, unique keys/tags for identifying shared elements (e.g., `"trendingImage-${photo.id}"` to differentiate from search result shared elements if necessary, or a common prefixing strategy).
    * _(Hint: See `tech-stack.md`.)_

* **API Interactions / SDK Usage:**
    * Not directly applicable for the navigation action itself. `ImageDetailScreen` handles its own data fetching/display based on the passed ID.
    * _(Hint: See `docs/api-reference.md`)_

* **Data Structures:**
    * `Photo.id` (Int) passed as a navigation argument.
    * _(Hint: See `data-models.md v1.1`.)_

* **Environment Variables:**
    * Not applicable.
    * _(Hint: See `environment-vars.md`)_

* **Coding Standards Notes:**
    * Ensure shared element tags/keys are unique per photo item across the app if `LookaheadLayout` scope is very broad, or ensure they are unique within the context of active transitions.
    * The complexity of shared element transitions across different navigation graph destinations with `LookaheadLayout` should be carefully managed. If it proves overly complex or unstable, a simpler standard transition (e.g., fade or slide from Story 9.4) should be used as a fallback for this specific navigation path.
    * Navigation argument passing for `photoId` must be robust.
    * Adhere to "UI Animations and Transitions" section in `docs/coding-standards.md`.
    * _(Hint: See `docs/coding-standards.md`.)_

## Tasks / Subtasks

* [ ] **Modify `HomeScreen.kt` Click Handling:**
    * [ ] In the `LazyVerticalStaggeredGrid`'s `items` block, ensure the `onItemClick` lambda of `ImageItem` is correctly implemented:
      ```kotlin
      // ImageItem(
      //     photo = photo,
      //     onItemClick = { clickedPhoto ->
      //         navController.navigate(ScreenRoutes.IMAGE_DETAIL + "/${clickedPhoto.id}")
      //         // Potentially pass additional info for shared element transition if needed by the framework,
      //         // e.g. by storing some state in a shared ViewModel that LookaheadLayout can access,
      //         // or relying on Navigation Compose's own shared element capabilities if enhanced.
      //     },
      //     // Potentially pass sharedElementModifier here for LookaheadLayout,
      //     // e.g., Modifier.sharedElementWithKey("image-${photo.id}") or similar API
      // )
      ```
* **Adapt Shared Element Transition (from Story 9.1):**
    * [ ] Review the implementation of shared element transitions (presumably using `LookaheadLayout` or a similar advanced Compose technique from Story 9.1).
    * [ ] Ensure that `ImageItem` on `HomeScreen` can provide the necessary information (e.g., a shared layout ID or modifier) for its `AsyncImage` to be a source.
    * [ ] Ensure `ImageDetailScreen` can use the same information for its main `AsyncImage` to be the target.
    * [ ] If `LookaheadLayout` needs to span across `HomeScreen` and `ImageDetailScreen` through the navigation graph, this setup in `AppNavigation.kt` might need to be carefully reviewed or adjusted. This is the most complex part.
* **Test Navigation:**
    * [ ] Verify basic navigation from a `HomeScreen` image item to `ImageDetailScreen` with the correct `photoId`.
* **Test Shared Element Transition (If Implemented):**
    * [ ] Verify the visual animation: image smoothly transitions from `HomeScreen` grid cell to `ImageDetailScreen`.
    * [ ] Verify reverse transition.
    * [ ] Test performance.
* **Fallback Transition:**
    * [ ] If shared element transition from `HomeScreen` proves too problematic for this specific path within reasonable effort, ensure a graceful standard screen transition (e.g., fade or slide as per Story 9.4) is used. Document the decision and reasons.

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests.

* **Unit Tests:**
    * Not the primary method for testing navigation or complex animations.
* **Integration Tests (UI Tests using Jetpack Compose UI Test):**
    * (Challenging for verifying shared element animation details directly).
    * Test that clicking an `ImageItem` on `HomeScreen` results in navigation to `ImageDetailScreen`.
    * Verify that the correct `photoId` is received as an argument by `ImageDetailScreen`.
    * _(Refer to `testing-strategy.md` for UI test considerations.)_
* **Manual/CLI Verification (Primary method):**
    * AC1: Tap on an image within the `LazyVerticalStaggeredGrid` on `HomeScreen`. Verify that the application navigates to the `ImageDetailScreen`.
    * AC2: On the `ImageDetailScreen`, confirm that the image and its associated details match the photo that was tapped on the `HomeScreen`.
    * AC3: Observe the screen transition. It should be smooth and without noticeable lag or visual glitches.
    * AC4: If the shared element transition is successfully implemented for this path:
        * Visually confirm that the tapped image animates (e.g., scales and moves) from its position in the `HomeScreen` grid to its final, larger position on the `ImageDetailScreen`.
        * Verify the reverse animation when navigating back from `ImageDetailScreen` to `HomeScreen`.
        * Assess the performance and visual polish of this animation.
* _(Hint: See `testing-strategy.md` and `docs/deep-research-bonus-features.md` [264-265, 280].)_
