
# Story 10.7: Navigate from HomeScreen Image to Detail View

**Status:** Draft

## Goal & Context

**User Story:** As a user, when I tap on an image in the HomeScreen's trending photos grid, I want to be taken to the detailed view of that image.

**Context:** This story connects the new `HomeScreen` (displaying trending photos) to the existing `ImageDetailScreen` (from Epic 4, enhanced by Epic 6 for zoom). It involves making `ImageItem`s in the `LazyVerticalStaggeredGrid` clickable and handling the navigation, potentially including the shared element transition from Epic 9. This implements PRD v1.2 [38], [183], [454].

## Detailed Requirements

* Make each `ImageItem` in the `LazyVerticalStaggeredGrid` on `HomeScreen` clickable (if `onItemClick` lambda in `ImageItem` isn't already fully utilized for this, ensure it is now).
* On tap, trigger navigation to the `ImageDetailScreen`.
* Pass the selected `Photo`'s ID (e.g., `photo.id`) to `ImageDetailScreen` via navigation arguments, consistent with how search results navigate to detail (Story 4.1).
* **Shared Element Transition (from Story 9.1):** Attempt to apply the shared element transition for this navigation path.
    * This means the `AsyncImage` in the `ImageItem` on `HomeScreen` and the main `AsyncImage` in `ImageDetailScreen` need to be identified with a common shared element tag (e.g., based on `photo.id`).
    * The `LookaheadLayout` or chosen shared element mechanism needs to be set up to work across this navigation action. This might involve ensuring `LookaheadLayout` scopes are correctly placed or that necessary information (bounds, keys) is passed.

## Acceptance Criteria (ACs)

* AC1: Tapping an image in the `LazyVerticalStaggeredGrid` on `HomeScreen` successfully navigates the user to the `ImageDetailScreen`.
* AC2: The correct `Photo` data for the tapped image is displayed on `ImageDetailScreen` (retrieved via ID by `ImageDetailViewModel` or `SearchViewModel` as per Story 4.1's detail screen logic).
* AC3: Navigation is smooth.
* AC4: (If feasible and implemented in Story 9.1 and adapted here) A shared element transition animates the tapped image from its position in the `HomeScreen` grid to the `ImageDetailScreen`, and back when returning.

## Technical Implementation Context

**Guidance:** Use the following details for implementation. HomeScreen (Story 10.1), ImageDetailScreen (Epic 4), and Shared Element Transition basics (Story 9.1) are relevant.

* **Relevant Files:**
    * Files to Modify:
        * `app/src/main/java/com/nguyenmoclam/pexelssample/ui/home/HomeScreen.kt` (to handle click and initiate navigation).
        * `app/src/main/java/com/nguyenmoclam/pexelssample/ui/common/ImageItem.kt` (to ensure it's clickable and can participate in shared element transition by accepting a shared element modifier/tag).
        * `app/src/main/java/com/nguyenmoclam/pexelssample/core/navigation/AppNavigation.kt` (if shared element transition needs specific setup at NavHost or composable destination level for this path).
        * `app/src/main/java/com/nguyenmoclam/pexelssample/ui/detail/ImageDetailScreen.kt` (to participate in shared element transition).
    * _(Hint: `docs/coding-standards.md` for navigation and animations.)_

* **Key Technologies:**
    * Jetpack Navigation Compose (`navController.navigate`).
    * `Modifier.clickable`.
    * Shared Element Transition APIs from Jetpack Compose (e.g., `LookaheadLayout`, `Modifier.intermediateLayout`, or other relevant APIs if `LookaheadLayout` is not directly suitable between nav graph destinations).
    * Stable, unique keys/tags for shared elements (e.g., `"image-${photo.id}"`).
    * _(Hint: See `tech-stack.md`.)_

* **API Interactions / SDK Usage:**
    * Not applicable for navigation itself. Detail screen handles its own data needs.
    * _(Hint: See `docs/api-reference.md`)_

* **Data Structures:**
    * `Photo.id` passed as navigation argument.
    * _(Hint: See `data-models.md v1.1`.)_

* **Environment Variables:**
    * Not applicable.
    * _(Hint: See `environment-vars.md`)_

* **Coding Standards Notes:**
    * Ensure shared element tags are unique per image.
    * If `LookaheadLayout` is used, understand its scoping for animations across navigation destinations. This can be complex. Simpler fade/slide as fallback if shared element is problematic here.
    * Navigation argument passing must be robust.
    * Adhere to "UI Animations and Transitions" in `docs/coding-standards.md` (v1.2).
    * _(Hint: See `docs/coding-standards.md`.)_

## Tasks / Subtasks

* [ ] **Modify `ImageItem.kt` for Shared Element Transition:**
    * [ ] Add a new parameter, e.g., `sharedElementModifier: Modifier = Modifier`.
    * [ ] Apply this `sharedElementModifier` to the `AsyncImage` Composable within `ImageItem`. This modifier will be constructed by the calling screen (`HomeScreen` or `SearchResultsListComposable`) to participate in `LookaheadLayout` or a similar mechanism.
      ```kotlin
      // In ImageItem.kt
      // AsyncImage(
      //    modifier = Modifier.fillMaxSize().then(sharedElementModifier), // Apply it
      // ...
      // )
      ```
* [ ] **Modify `HomeScreen.kt`:**
    * [ ] In the `LazyVerticalStaggeredGrid`'s `items` block, when calling `ImageItem`:
        * Make it clickable: `onItemClick = { photo -> navController.navigate(ScreenRoutes.IMAGE_DETAIL + "/${photo.id}") }`.
        * If using `LookaheadLayout` from a shared parent scope:
            * Define the shared element modifier for `ImageItem`'s `AsyncImage`:
              ```kotlin
              // Inside LookaheadScope (e.g., provided by AppNavigation or HomeScreen itself)
              // ImageItem(
              //    photo = photo,
              //    sharedElementModifier = Modifier.intermediateLayout { ... } // or Modifier.sharedElement() etc.
              //    onItemClick = { ... }
              // )
              ```
* [ ] **Modify `ImageDetailScreen.kt` for Shared Element Transition:**
    * [ ] The main `AsyncImage` here also needs to apply a corresponding shared element modifier, using the same unique ID (e.g., from `photoId` nav argument).
      ```kotlin
      // Inside LookaheadScope
      // AsyncImage(
      //    model = currentPhoto.src.large2x,
      //    modifier = Modifier.fillMaxWidth().intermediateLayout { ... } // or .sharedElement()
      // ...
      // )
      ```
* [ ] **Coordinate with `AppNavigation.kt` / `LookaheadLayout`:**
    * Determine the scope of `LookaheadLayout`. If transitions are desired between separate navigation destinations, `LookaheadLayout` might need to wrap the `NavHost` or specific parts of it. This is the most complex part.
    * Consult latest Compose documentation for patterns on shared element transitions *between navigation destinations* using `LookaheadLayout`.
* [ ] Test navigation and the shared element transition thoroughly. If the full shared element is too complex to stabilize quickly, implement a graceful fallback (e.g., standard fade/slide from Story 9.4) and log the complexity for future refinement.

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests.

* **Unit Tests:**
    * Not primary.
* **Integration Tests (UI Tests):**
    * (Challenging for animation) Test navigation to `ImageDetailScreen` occurs with correct `photoId`.
    * _(Refer to `testing-strategy.md`.)_
* **Manual/CLI Verification (Primary method):**
    * AC1: Tap an image on `HomeScreen`. Verify it navigates to `ImageDetailScreen`.
    * AC2: Verify the correct image and its details are shown on `ImageDetailScreen`.
    * AC3: Observe navigation smoothness.
    * AC4: If shared element transition is implemented:
        * Verify the image animates from its grid cell to the detail view.
        * Verify the reverse animation when pressing back.
        * Check performance and visual correctness on different devices/aspect ratios.
* _(Hint: See `testing-strategy.md` and `docs/deep-research-bonus-features.md` [264-265, 280].)_
