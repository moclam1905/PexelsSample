
# Story 10.3: Implement Dynamic Column Count for HomeScreen Grid

**Status:** Draft

## Goal & Context

**User Story:** As a user, I want the HomeScreen's photo grid to adapt its number of columns based on my device's screen size and orientation, so it always looks well-organized and utilizes space effectively.

**Context:** This story applies the `WindowSizeClass` mechanism (from Epic 7, Story 7.1) to the new `HomeScreen`'s `LazyVerticalStaggeredGrid` (from Story 10.1). The number of columns will adapt dynamically. This addresses PRD v1.2 [40], [185], [456].

## Detailed Requirements

* `HomeScreen.kt` will consume `WindowSizeClass` (provided from `MainActivity` or a root Composable, as established in Story 7.1).
* Dynamically set the `columns` parameter of `LazyVerticalStaggeredGrid.Fixed(count)` based on `windowSizeClass.widthSizeClass`. Consideration for `LocalConfiguration.current.orientation` can also be included if finer control than `widthSizeClass` alone is desired.
    * Example based on `widthSizeClass`:
        * `WindowWidthSizeClass.Compact`: 2 columns.
        * `WindowWidthSizeClass.Medium`: 3 columns.
        * `WindowWidthSizeClass.Expanded`: 4 columns.
* Ensure item spans and content within `ImageItem` adapt well to changing column counts, leveraging the nature of staggered grid for variable heights.

## Acceptance Criteria (ACs)

* AC1: The number of columns in `LazyVerticalStaggeredGrid` on `HomeScreen` is 2 when `windowSizeClass.widthSizeClass` is `Compact`.
* AC2: The number of columns is 3 when `windowSizeClass.widthSizeClass` is `Medium`.
* AC3: The number of columns is 4 when `windowSizeClass.widthSizeClass` is `Expanded`.
* AC4: The staggered layout remains visually appealing, and items are well-proportioned with different column counts and during orientation changes.
* AC5: State (scroll position, loaded items) is reasonably preserved during column count changes due to configuration updates (e.g., rotation).

## Technical Implementation Context

**Guidance:** Use the following details for implementation. Stories 10.1 and 7.1 are complete.

* **Relevant Files:**
    * Files to Modify:
        * `app/src/main/java/com/nguyenmoclam/pexelssample/ui/home/HomeScreen.kt`
    * _(Hint: `research-homescreen-trending-photos.md` [Section 2]. `docs/coding-standards.md`.)_

* **Key Technologies:**
    * Jetpack Compose: `LazyVerticalStaggeredGrid`, `StaggeredGridCells.Fixed()`, `WindowSizeClass`, `WindowWidthSizeClass`, `LocalConfiguration`.
    * _(Hint: `tech-stack.md`.)_

* **API Interactions / SDK Usage:**
    * Not applicable.
    * _(Hint: `api-reference.md`)_

* **Data Structures:**
    * `WindowSizeClass` object.
    * _(Hint: `data-models.md v1.1`.)_

* **Environment Variables:**
    * Not applicable.
    * _(Hint: `environment-vars.md`)_

* **Coding Standards Notes:**
    * Logic for determining column count should be clear.
    * Staggered grid's adaptive nature helps with item heights, focus on column width appropriateness.
    * Test across various device configurations.
    * Adhere to `docs/coding-standards.md`.
    * _(Hint: See `coding-standards.md`.)_

## Tasks / Subtasks

* [ ] Modify `HomeScreen.kt`:
    * [ ] Ensure it receives `windowSizeClass: WindowSizeClass` as a parameter (or from `CompositionLocal`).
    * [ ] Define `columnCount` based on `windowSizeClass.widthSizeClass`:
      ```kotlin
      // val configuration = LocalConfiguration.current
      // val orientation = configuration.orientation
      val columnCount = when (windowSizeClass.widthSizeClass) {
          WindowWidthSizeClass.Compact -> 2 // Could adjust for landscape: if (orientation == Configuration.ORIENTATION_LANDSCAPE) 3 else 2
          WindowWidthSizeClass.Medium -> 3
          WindowWidthSizeClass.Expanded -> 4
          else -> 2 // Default
      }
      ```
    * [ ] Use this `columnCount` in `LazyVerticalStaggeredGrid`: `columns = StaggeredGridCells.Fixed(columnCount)`.
    * [ ] Verify `ImageItem` adapts well.
* [ ] Test on phone (portrait/landscape) and tablet (portrait/landscape) emulators, or with resizable emulator.

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests.

* **Unit Tests:**
    * Not primary, unless column calculation logic becomes complex and is extracted.
* **Integration Tests (UI Tests):**
    * (To be formalized) Provide different `WindowSizeClass` to `HomeScreen`. Assert column count or layout structure.
    * _(Refer to `testing-strategy.md`.)_
* **Manual/CLI Verification:**
    * AC1: Phone portrait (`Compact` width) -> Verify 2 columns.
    * AC2: Phone landscape (often `Medium` width) or Tablet portrait (`Medium` width) -> Verify 3 columns.
    * AC3: Tablet landscape (`Expanded` width) -> Verify 4 columns.
    * AC4: Visually inspect layout and item proportions in each case.
    * AC5: Rotate device while `HomeScreen` is visible. Verify grid adapts, scroll position is reasonably kept, and data isn't re-fetched unnecessarily.
* _(Hint: See `testing-strategy.md` and `research-homescreen-trending-photos.md` [Section 2].)_