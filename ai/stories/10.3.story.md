
# Story 10.3: Implement Dynamic Column Count for HomeScreen Grid

**Status:** Draft

## Goal & Context

**User Story:** As a user, I want the `HomeScreen`'s photo grid to adapt its number of columns based on my device's screen size and orientation, so it always looks well-organized and utilizes space effectively.

**Context:** This story applies the `WindowSizeClass` mechanism (from Epic 7, Story 7.1) to the `HomeScreen`'s `LazyVerticalStaggeredGrid` (from Story 10.1). The number of columns will adapt dynamically, ensuring optimal use of screen real estate. This addresses PRD v1.2 [40], [185], [456].

## Detailed Requirements

* `HomeScreen.kt` will consume `WindowSizeClass` (provided from `MainActivity` or a root Composable, as established in Story 7.1).
* Dynamically set the `columns` parameter of `LazyVerticalStaggeredGrid.Fixed(count)` based on `windowSizeClass.widthSizeClass`. Consideration for `LocalConfiguration.current.orientation` can also be included if finer control than `widthSizeClass` alone is desired.
  * Example based on `widthSizeClass`:
    * `WindowWidthSizeClass.Compact`: 2 columns.
    * `WindowWidthSizeClass.Medium`: 3 columns.
    * `WindowWidthSizeClass.Expanded`: 4 columns.
* Ensure item spans and content within `ImageItem` adapt well to changing column counts, leveraging the nature of staggered grid for variable heights.

## Acceptance Criteria (ACs)

* AC1: The number of columns in `LazyVerticalStaggeredGrid` on `HomeScreen` is 2 when `windowSizeClass.widthSizeClass` is `Compact`.
* AC2: The number of columns is 3 when `windowSizeClass.widthSizeClass` is `Medium`.
* AC3: The number of columns is 4 when `windowSizeClass.widthSizeClass` is `Expanded`.
* AC4: The staggered layout remains visually appealing, and items are well-proportioned with different column counts and during orientation changes.
* AC5: State (scroll position, loaded items) is reasonably preserved during column count changes due to configuration updates (e.g., rotation).

## Technical Implementation Context

**Guidance:** Use the following details for implementation. Stories 10.1 and 7.1 are complete.

* **Relevant Files:**
  * Files to Modify:
    * `app/src/main/java/com/nguyenmoclam/pexelssample/ui/home/HomeScreen.kt`
  * _(Hint: `research-homescreen-trending-photos.md` [Section 2]. `docs/coding-standards.md`.)_

* **Key Technologies:**
  * Jetpack Compose: `LazyVerticalStaggeredGrid`, `StaggeredGridCells.Fixed()`, `WindowSizeClass`, `WindowWidthSizeClass`, `LocalConfiguration`.
  * _(Hint: `tech-stack.md`.)_

* **API Interactions / SDK Usage:**
  * Not applicable.
  * _(Hint: `api-reference.md`)_

* **Data Structures:**
  * `WindowSizeClass` object.
  * _(Hint: See `data-models.md v1.1`.)_

* **Environment Variables:**
  * Not applicable.
  * _(Hint: See `environment-vars.md`)_

* **Coding Standards Notes:**
  * Logic for determining column count should be clear and driven by `widthSizeClass`.
  * The staggered grid's nature helps with item heights; focus on column width appropriateness.
  * Test across various device configurations (phones, tablets, orientations).
  * Adhere to guidelines in `docs/coding-standards.md` section "Adaptive Design with WindowSizeClasses".
  * _(Hint: See `docs/coding-standards.md`.)_

## Tasks / Subtasks

* [ ] Modify `HomeScreen.kt`:
  * [ ] Ensure it receives `windowSizeClass: WindowSizeClass` as a parameter (or accesses it via `CompositionLocal` as set up in Story 7.1).
  * [ ] Define `columnCount` based on `windowSizeClass.widthSizeClass`:
    ```kotlin
    // import androidx.compose.material3.windowsizeclass.WindowWidthSizeClass
    // import androidx.compose.ui.platform.LocalConfiguration
    // import android.content.res.Configuration
    
    // val configuration = LocalConfiguration.current
    // val isLandscape = configuration.orientation == Configuration.ORIENTATION_LANDSCAPE
    
    val columnCount = when (windowSizeClass.widthSizeClass) {
        WindowWidthSizeClass.Compact -> 2 // Could refine: if (isLandscape) 3 else 2
        WindowWidthSizeClass.Medium -> 3
        WindowWidthSizeClass.Expanded -> 4
        else -> 2 // Default fallback
    }
    ```
  * [ ] Use this `columnCount` in `LazyVerticalStaggeredGrid`: `columns = StaggeredGridCells.Fixed(columnCount)`.
  * [ ] Verify `ImageItem` (from Story 3.2) adapts well within the columns. Its modifier might need to be `Modifier.fillMaxWidth()` within the context of a grid cell to take up the column's width.
* [ ] Test the `HomeScreen` on different emulators/devices or using resizable emulators / Compose Previews with varying `widthSizeClass` values:
  * Phone Portrait (`Compact` width).
  * Phone Landscape (`Medium` or `Compact` width, depending on specific device/density).
  * Tablet Portrait (`Medium` width).
  * Tablet Landscape (`Expanded` width).
* [ ] Verify visual appeal, item spacing (Story 10.5 may refine this), and performance for each configuration.

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests.

* **Unit Tests:**
  * Not primarily for this UI adaptation logic if it's simple conditional logic within the Composable. If column calculation becomes complex and is extracted to a helper function, unit test that function.
* **Integration Tests (UI Tests using Jetpack Compose UI Test):**
  * (To be formalized later)
  * Create tests that provide different `WindowSizeClass` values to `HomeScreen` (this may require test utilities or a specific test rule to control the `WindowSizeClass` provided to the Composable under test).
  * Assert the number of columns used by `LazyVerticalStaggeredGrid` matches expectations by querying the layout info or item count per row if feasible.
  * _(Refer to `testing-strategy.md` for UI test considerations for adaptive layouts.)_
* **Manual/CLI Verification:**
  * AC1: Run app on a standard phone emulator in portrait mode (`Compact` width). Verify the `LazyVerticalStaggeredGrid` on `HomeScreen` displays 2 columns.
  * AC2: Rotate the phone emulator to landscape (if this typically results in `Medium` width) or run on a small tablet/foldable emulator in portrait mode. Verify 3 columns.
  * AC3: Run app on a tablet emulator in landscape mode (`Expanded` width). Verify 4 columns.
  * AC4: Visually inspect the layout in each configuration. Ensure `ImageItem`s are well-proportioned, and the staggered effect is maintained and looks appealing. Check item spacing.
  * AC5: Rotate the device while `HomeScreen` is displaying content. Verify the grid adapts to the new column count smoothly, scroll position is reasonably maintained, and data isn't unnecessarily re-fetched.
* _(Hint: See `testing-strategy.md` and `research-homescreen-trending-photos.md` [Section 2].)_