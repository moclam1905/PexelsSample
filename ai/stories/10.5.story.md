
# Story 10.5: Enhance HomeScreen UI/UX (Placeholders, Shimmer, Spacing, Corners)

**Status:** Draft

## Goal & Context

**User Story:** As a user, I want the HomeScreen grid to look highly polished and modern, with smooth loading indicators and visually appealing item presentation.

**Context:** This story focuses on the UI polish aspects for the `HomeScreen`'s `LazyVerticalStaggeredGrid`, as detailed in PRD v1.2 [48], [57], [89], [193], [202], [234], [464], [473], [505] and the `research-homescreen-trending-photos.md` document. It includes implementing shimmer loading effects for image placeholders, consistent item spacing, rounded corners for items, and proper content padding for the grid.

## Detailed Requirements

* Define `Arrangement.spacedBy(...)` for `LazyVerticalStaggeredGrid`'s `verticalItemSpacing` and `horizontalArrangement` to ensure consistent spacing between items (e.g., 8.dp).
* Apply `Modifier.clip(RoundedCornerShape(X.dp))` (e.g., 8.dp or 12.dp) to each `ImageItem` when displayed in the HomeScreen grid. This should be applied to the `ImageItem`'s root container.
* `AsyncImage` within `ImageItem` should use a color placeholder (e.g., from `Photo.avgColor` if available and parsed quickly, or a default light grey color). This functionality might already exist in `ImageItem` from Epic 3 (Story 3.2) but must be verified and consistently applied in the HomeScreen context.
* Implement or integrate a shimmer effect:
  * Research and select a suitable Compose shimmer effect library (e.g., a Compose-compatible version of Facebook's Shimmer, or another well-regarded option like those explored in `research-homescreen-trending-photos.md`) or implement a basic custom shimmer. Add chosen library as a dependency.
  * The shimmer effect should be applied as a visual overlay or background to the placeholder areas of `ImageItem`s while their actual images are loading via Coil. This typically means the placeholder itself (e.g., a colored `Box`) will have the shimmer animation applied.
* Add `contentPadding` to the `LazyVerticalStaggeredGrid` itself (e.g., horizontal 12.dp, vertical 8.dp) to ensure content isn't flush against screen edges.

## Acceptance Criteria (ACs)

* AC1: `LazyVerticalStaggeredGrid` items on `HomeScreen` have consistent vertical and horizontal spacing applied (e.g., 8.dp).
* AC2: `ImageItem`s displayed in the HomeScreen grid have rounded corners (e.g., 12.dp).
* AC3: A shimmer loading effect is displayed over `ImageItem` placeholders (which use `Photo.avgColor` or a default gray) while their respective images are loading from Coil. The shimmer is smooth, visually appealing, and performant.
* AC4: `LazyVerticalStaggeredGrid` on `HomeScreen` has appropriate `contentPadding` (e.g., 12.dp horizontal, 8.dp vertical).
* AC5: The overall loading experience for images in the `HomeScreen` grid feels polished and modern, with the shimmer effect reducing perceived wait time.
* AC6: (From PO Analysis Recommendation) The `ImageItem` on `HomeScreen` uses `photo.alt` for its `contentDescription` for accessibility, as per PRD [49], [194], [465].

## Technical Implementation Context

**Guidance:** Use the following details for implementation. Story 10.1 established the basic grid; `ImageItem` exists from Epic 3.

* **Relevant Files:**
  * Files to Modify:
    * `app/src/main/java/com/nguyenmoclam/pexelssample/ui/home/HomeScreen.kt` (for grid parameters like spacing, contentPadding).
    * `app/src/main/java/com/nguyenmoclam/pexelssample/ui/common/ImageItem.kt` (to integrate shimmer effect, verify placeholder, apply rounded corners if not globally done, ensure `contentDescription`).
    * `libs.versions.toml` & `app/build.gradle.kts` (if a new shimmer library is added).
  * Files to Create:
    * Potentially a `ShimmerBrush.kt` or reusable shimmer Composable if implementing manually or significantly customizing a library.
  * _(Hint: `research-homescreen-trending-photos.md` [Enhanced UI/UX section]. PRD [89], [202], [234], [473], [505]. `tech-stack.md` mentions TBD for shimmer library. `coding-standards.md` updated for shimmer.)_

* **Key Technologies:**
  * Jetpack Compose: `LazyVerticalStaggeredGrid` parameters, `Modifier.clip(RoundedCornerShape)`, `Modifier.background`, `PaddingValues`.
  * Coil `AsyncImage` (for placeholder support and image loading).
  * Shimmer Effect Library (e.g., `com.google.accompanist:accompanist-placeholder` if still suitable and maintained for M3, or a newer alternative like `com.valentinilk.shimmer`, or custom implementation using `Brush.linearGradient` animated). *Tech stack should be updated once a library is chosen.*
  * _(Hint: `tech-stack.md`. `coding-standards.md`.)_

* **API Interactions / SDK Usage:**
  * Not applicable.
  * _(Hint: See `docs/api-reference.md`)_

* **Data Structures:**
  * Not applicable.
  * _(Hint: See `data-models.md v1.1`.)_

* **Environment Variables:**
  * Not applicable.
  * _(Hint: See `environment-vars.md`)_

* **Coding Standards Notes:**
  * Shimmer effect should be subtle yet effective, and highly performant.
  * Rounded corners and spacing values should be consistent with Material Design principles or specified design.
  * Ensure shimmer animation stops correctly when the image is loaded or if loading fails.
  * `contentDescription` in `ImageItem` is critical for accessibility.
  * Adhere to `docs/coding-standards.md`.
  * _(Hint: See `docs/coding-standards.md`.)_

## Tasks / Subtasks

* [ ] **Implement Grid Spacing and Padding on `HomeScreen.kt`:**
  * [ ] Set `verticalItemSpacing = 8.dp` (or chosen value) on `LazyVerticalStaggeredGrid`.
  * [ ] Set `horizontalArrangement = Arrangement.spacedBy(8.dp)` (or chosen value) on `LazyVerticalStaggeredGrid`.
  * [ ] Set `contentPadding = PaddingValues(horizontal = 12.dp, vertical = 8.dp)` (or chosen values) on `LazyVerticalStaggeredGrid`.
* [ ] **Modify `ImageItem.kt`:**
  * [ ] Ensure the root container of `ImageItem` (e.g., `Card` or `Box`) has `Modifier.clip(RoundedCornerShape(12.dp))` (or chosen value).
  * [ ] Verify/Implement `AsyncImage`'s `placeholder` uses `Photo.avgColor` (with fallback to default gray) as background, as done in Story 3.2.
  * [ ] Ensure `AsyncImage` uses `contentDescription = photo.alt.ifBlank { "Photo by ${photo.photographer}" }` for AC6.
* [ ] **Research, Select, and Integrate Shimmer Effect:**
  * [ ] Choose a shimmer library compatible with Compose M3 and current dependencies, or prepare for custom implementation. (e.g., `com.valentinilk.shimmer` if a compose artifact exists and is stable, or a custom `Modifier.drawWithContent` approach using animated gradients).
  * [ ] If using a library, add dependency to `libs.versions.toml` and `app/build.gradle.kts`. Update `docs/tech-stack.md`.
  * [ ] Modify `ImageItem.kt` to apply the shimmer effect to its placeholder area. This usually involves applying a shimmer modifier to the placeholder Composable (e.g., the `Box` used in `AsyncImage`'s `placeholder` slot) when `AsyncImage` is in a loading state.
      ```kotlin
      // Conceptual example within ImageItem, for AsyncImage's placeholder slot:
      // placeholder = {
      //     val painterState = Local برخیState // This is just conceptual for painter state
      //     val isLoading = painterState is AsyncImagePainter.State.Loading // Simplified check
      //     Box(
      //         modifier = Modifier
      //             .fillMaxSize()
      //             .background(parseColor(photo.avgColor)) // Base placeholder color
      //             .then(if (isLoading) Modifier.shimmerEffect() else Modifier) // Apply shimmer when loading
      //     )
      // }
      // Note: Directly checking AsyncImagePainter.State inside placeholder might be tricky.
      // A more common approach is to use Coil's `onState` callback to update a local `isLoading` boolean state,
      // then use that boolean to conditionally apply the shimmer modifier to the placeholder Composable.
      ```
    Or, if using a library like `accompanist-placeholder` (if it were still the primary choice and M3 compatible):
      ```kotlin
      // Modifier.placeholder(
      //    visible = isLoading,
      //    color = Color.Gray, // Base placeholder color
      //    highlight = PlaceholderHighlight.shimmer(highlightColor = Color.White)
      // )
      ```
* [ ] Test the shimmer effect, ensuring it's smooth, covers the placeholder area, and stops when image loads/errors.
* [ ] Test item spacing, rounded corners, and grid content padding visually.

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests.

* **Unit Tests:**
  * Not primary for these visual UI polish elements.
* **Integration Tests (UI Tests using Jetpack Compose UI Test):**
  * (Challenging for shimmer effect validation). Semantic queries can be used to verify that `contentPadding` is applied to the grid and that `ImageItem`s have a clip modifier (if inspectable).
  * Verify `contentDescription` is correctly set on `ImageItem`s.
  * _(Refer to `testing-strategy.md`.)_
* **Manual/CLI Verification (Primary method):**
  * AC1: Visually inspect the `HomeScreen` grid. Confirm consistent and adequate spacing between all items, both vertically and horizontally.
  * AC2: Confirm that all `ImageItem`s displayed in the HomeScreen grid have visibly rounded corners.
  * AC3: As images load into the `HomeScreen` grid (especially on a slower connection or first load), verify that a shimmer animation is displayed over the placeholder areas of the `ImageItem`s. The shimmer should be smooth and not cause jank.
  * AC4: Confirm that the `LazyVerticalStaggeredGrid` has padding from the screen edges, so items don't touch the absolute screen borders.
  * AC5: Assess the overall visual appeal during image loading. The placeholders and shimmer effect should create a more professional and less jarring loading experience.
  * AC6: Using an accessibility inspector tool (like Layout Inspector's semantics view or TalkBack), verify that images on the `HomeScreen` have their `contentDescription` correctly set from `photo.alt`.
* _(Hint: See `testing-strategy.md` and `research-homescreen-trending-photos.md` [Enhanced UI/UX section].)_